#!/usr/bin/env node

const fs = require('fs');
const winston = require('winston');
const http2 = require('http2');
const config = require('../config');

const app = require('../app');
let server = app;


if (config.get('NODE_ENV') === 'production') {
    app.use((req, res) => res.status(404).render('errors/404.html'));
    app.use((err, req, res, next) => res.status(500).render('errors/500.html'));
}


if (config.get('NODE_ENV') === 'production') {
    const options = {
        key: fs.readFileSync(config.get('CERT_KEY_PATH')),
        cert: fs.readFileSync(config.get('CERT_PATH'))
    };
    server = http2.createServer(options, app);
}

server.listen(config.get('PORT'),
    _ => winston.info(`Server is now running at port ${config.get('PORT')}`));
